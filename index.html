<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Student Portfolio</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="page">
    <!-- HERO SECTION -->
    <header class="hero">
      <div class="hero-top-actions">
        <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme">
          ðŸŒ™
        </button>

        <button class="music-toggle" id="music-toggle" aria-label="Toggle music">
          ðŸŽ§
        </button>
      </div>

      <div class="hero-content">
        <p class="hero-tagline">Embedded Engineer â€¢ Student</p>
        <h1 class="hero-title">
          Hey there,<br /> 
          Iâ€™m <span class="accent">Krishnaveni Pola</span>
        </h1>
        <h2 class="hero-sub">  Welcome to my Portfolio!! </h2>
        <p class="hero-typing" id="hero-typing">
        </p>
        <!-- <button class="hero-cta" id="projects-cta">View my projects</button> -->
      </div>

      <div class="hero-visual">
        <div class="hero-photo-frame">
          <img src="pictures/hero.png" alt="Friendly illustration" />
        </div>
        <div class="hero-orbit hero-orbit--one"></div>
        <div class="hero-orbit hero-orbit--two"></div>
      </div>

    </header>

    <!-- ABOUT SECTION -->
    <section class="about" id="about">
      <div class="about-inner">
        <div class="about-text">
          <h2>About me</h2>
          <p>
            Hi! Iâ€™m Krishnaveni â€” an engineer-in-progress, endlessly curious, and someone who enjoys understanding 
            how things work.Iâ€™m the kind of person who gets excited about new ideas, asks too many "why" questions, 
            and believes that learning something new is one of the best feelings ever. 
          </p>
          <p>
            I enjoy creating thingsâ€”whether itâ€™s a design, a concept, or a completely random solution that somehow 
            works.My personality sits somewhere between organized chaos and calm determination.
          </p>
          <p>
           Iâ€™m someone who says what I think, asks the questions others hesitate to ask, and isnâ€™t afraid to start 
           the conversations everyone else avoids. Talking to people comes naturally to me â€” I love hearing 
           different viewpoints, understanding how others think, and building connections that feel real and 
           effortless. 
           Iâ€™m the type of person who can walk into a room and find common ground with anyone, whether we share the 
           same interests or not. I pay attention to people, emotions, and energy, and I adapt quickly without 
           losing who I am.
          </p>
          <p>
            I love creating things â€” whether itâ€™s a prototype, a concept, or a workaround that somehow just works â€” 
            and I thrive in spaces where creativity meets logic. My best thinking usually involves a notebook, a 
            playlist, and far too many tabs open.
          </p>
          <p>
            If I had to describe myself in three words?
            <h4>Creative. Curious. Bold.</h4>
          </p>
        </div>

        <div class="about-photo">
          <div class="about-photo-frame">
            <img src="me.jpg" alt="Krishnaveni Pola portrait" />
          </div>
        </div>
      </div>
    </section>



    <!-- PROJECTS SECTION -->
    <section class="projects" id="projects">
      <div class="projects-header">
        <h2>Selected projects</h2>
        <p>Hover a card to peek in. Click to dive into it.</p>
      </div>

      <div class="cards-wrapper">
        <div class="project-card project-card--cyan" data-target="#project-flappy">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures\flappy-bg.jpg" alt="Flappy Bird project preview" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">Flappy Bird game</span>
            </div>
          </div>
        </div>


        <div class="project-card project-card--red" data-target="#project-line-follower">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures\line-bg.jpg" alt="line following" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">line following robot</span>
            </div>
          </div>
        </div>

        <div class="project-card project-card--pink" data-target="#project-delivery-bot">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures\delivery-bg.jpg" alt="Delivery robot project preview" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">Delivery robot</span>
            </div>
          </div>
        </div>


        <div class="project-card project-card--blue" data-target="#project-crop-harvest">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures\tomato-bg.jpg" alt="Tomato project preview" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">Crop harvest robot</span>
            </div>
          </div>
        </div>

        <div class="project-card project-card--green" data-target="#project-classroom-finder">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures/classroom-bg.jpg" alt="Classroom Finder project preview" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">Classroom Finder</span>
            </div>
          </div>
        </div>

     
        <div class="project-card project-card--grey" data-target="#section-resume"">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures\resume-bg.jpg" alt="Resume project preview" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">Resume</span>
            </div>
          </div>
        </div>

        <div class="project-card project-card--yellow" data-target="#section-guestbook">
          <div class="project-card-inner">
            <div class="project-card-bg">
              <img src="pictures\guest.jpg" alt="Book project preview" />
            </div>
            <div class="project-card-header">
              <span class="project-card-label">Guest Book</span>
            </div>
          </div>
        </div>

      </div>
      
    </section>

    <!-- DETAIL SECTIONS + CHARACTER -->
    <div class="project-details-wrapper">
      <div class="project-details">

        <section id="section-skills" class="project-section">
          <div class="project-card-detail skills-graph-section">
            <div class="skills-graph-left">
              <h2>Skill graph</h2>
              <p class="skills-graph-hint">
                Click a bubble to see where Iâ€™ve used it.
              </p>
              <svg id="skills-graph" width="100%" height="360"></svg>
            </div>

            <aside class="skills-graph-details" id="skills-graph-details">
              <h3 id="skill-title">Click a skill</h3>
              <p id="skill-level">Skill level: â€“</p>
              <ul id="skill-projects">
                <li>Select a node on the graph to view projects using that skill.</li>
              </ul>
            </aside>
          </div>
        </section>




        <section id="project-flappy" class="project-section">
          <div class="project-card-detail">
            <div class="project-row">
              <div class="project-text">
                <h2>Flappy Bird game</h2>

                <div class="project-meta">
                  <span>ESP32</span>
                  <span>Game</span>
                  <span>OLED UI</span>
                </div>

                <p>
                  A hardware-based implementation of the classic Flappy Bird game built using an ESP32 microcontroller.
                  The project uses an OLED display to render game graphics and push buttons for player input. I designed
                  the game logic, collision detection, and score system directly on the microcontroller, demonstrating
                  embedded programming, real-time processing, and UI development on constrained hardware.
                </p>
              </div>

              <div class="project-media">
                <img src="pictures\flappy.png" alt="Flappy Bird game on OLED screen" />
              </div>
            </div>
          </div>
        </section>

        <section id="project-line-follower" class="project-section">
          <div class="project-card-detail">
            <div class="project-row">
              <div class="project-text">
                <h2>Line follower robot</h2>

                <div class="project-meta">
                  <span>Autonomous</span>
                  <span>IR Sensors</span>
                  <span>Control</span>
                </div>

                <p>
                  A fully autonomous robot designed to detect and follow a predefined path using IR sensors.
                  The system uses sensor feedback to continuously adjust motor control, ensuring smooth navigation even
                  on curves. This project strengthened my understanding of control systems, motor drivers, PID-like
                  corrections, and the integration of embedded hardware with real-time decision-making.
                </p>
              </div>

              <div class="project-media">
                <img src="pictures\line.jpg" alt="Line follower robot" />
              </div>
            </div>
          </div>
        </section>
        
        <section id="project-delivery-bot" class="project-section">
          <div class="project-card-detail">
            <div class="project-row">
              <div class="project-text">
                <h2>Delivery mobile manipulator</h2>

                <div class="project-meta">
                  <span>ESP32</span>
                  <span>Mobile Base</span>
                  <span>Robot Arm</span>
                </div>

                <p>
                  A two-wheeled delivery robot equipped with a robotic arm, powered by an ESP32-based control system.
                  The robot can be controlled via a web interface or Bluetooth, enabling remote item pickup, movement,
                  and placement. I worked on designing the mechanical system, writing the movement and arm-control algorithms,
                  and building a wireless UI. The project demonstrates skills in robotics, kinematics, IoT control,
                  and automation for real-world tasks.
                </p>
              </div>

              <div class="project-media">
                <img src="pictures\delivery.jpg" alt="Delivery mobile manipulator" />
              </div>
            </div>
          </div>
        </section>
        <section id="project-crop-harvest" class="project-section">
          <div class="project-card-detail">
            <div class="project-row">
              <div class="project-text">
                <h2>Crop harvesting robot</h2>

                <div class="project-meta">
                  <span>YOLO</span>
                  <span>Computer Vision</span>
                  <span>Agri-tech</span>
                </div>

                <p>
                  An autonomous crop-monitoring and harvesting robot built using YOLO-based vision models for detecting
                  ripeness stages. The robot identifies fruits (e.g., tomatoes) and classifies their ripeness using a
                  deep-learning model trained on custom datasets. It integrates computer vision with robotic actuation to
                  enable selective harvesting. This project highlights my skills in machine learning, dataset preparation,
                  robotics integration, and agricultural automation.
                </p>
                <p class="project-highlight">
                  Received â‚¹5,00,000 in competitive funding to scale this prototype into a deployable system.
                </p>

              </div>

              <div class="project-media">
                <img src="pictures/crop.jpg" alt="Crop harvesting robot" />
              </div>
            </div>
          </div>
        </section>

        <section id="project-classroom-finder" class="project-section">
          <div class="project-card-detail">
            <div class="project-row">
              <div class="project-text">
                <h2>Classroom Finder</h2>

                <div class="project-meta">
                  <span>Web app</span>
                  <span>Firebase</span>
                  <span>Maps / UI</span>
                </div>

                <p>
                  A mini web app that helps students quickly locate unused classrooms during exam seaon
                  on campus using a simple search interface and an interactive map. It stores room data
                  and schedules in the cloud so information stays up to date.
                </p>
                <p>
                  Built the front end with modern JavaScript and responsive CSS, and used Firebase for
                  real-time data storage and hosting. This project strengthened skills in UX for
                  navigation, data modelling, and integrating a cloud backend into a clean UI.
                </p>
              </div>

              <div class="project-media">
                <img src="pictures/classroom-finder.png" alt="Classroom Finder app UI" />
              </div>
            </div>
          </div>
        </section>



        <section id="section-resume" class="project-section">
          <div class="project-card-detail">
            <h2>Resume</h2>
            <p>You can view or download my resume here.</p>
            <a class="resume-button" href="resume.pdf" target="_blank" rel="noopener">
              View resume (PDF)
            </a>
          </div>
        </section>


        <section id="section-guestbook" class="project-section">
          <div class="project-card-detail">
            <h2>Guest Book</h2>
            <p>Drop a quick note or feedback about my projects.</p>

            <form id="guestbook-form" class="guestbook-form">
              <div class="guestbook-row">
                <input
                  type="text"
                  id="guest-name"
                  name="name"
                  placeholder="Your name"
                />
                <input
                  type="text"
                  id="guest-role"
                  name="role"
                  placeholder="Role / how we met (optional)"
                />
              </div>

              <textarea
                id="guest-message"
                name="message"
                rows="3"
                placeholder="Your message..."
                required
              ></textarea>

              <button type="submit" class="guestbook-submit">
                Sign guest book
              </button>
            </form>

            <!-- notice-board style guestbook -->
            <div id="guestbook-entries" class="guestbook-board">
              <!-- entries from Firebase will appear here -->
            </div>
          </div>
        </section>



        <section id="section-contact" class="project-section">
          <div class="project-card-detail">
            <h2>Contact</h2>
            <p>If youâ€™d like to collaborate or just say hi, feel free to reach out.</p>
            <div class="contact-links">
              <a href="mailto:krishnavenipola04@gmail.com">krishnavenipola04@gmail.com</a>
              <a href="https://www.linkedin.com/in/krishnaveni-pola/" target="_blank" rel="noopener">
                LinkedIn
              </a>
            </div>
          </div>
        </section>

      </div>


      <!-- Right-side cartoon -->
      <div class="project-character" id="project-character">
        <div class="project-character-inner">
          <img
            src="pictures\c9.png"
            alt="Friendly character waving"
            id="character-image"
            title="Click me âœ¨"
          />
          <!-- <span class="character-tooltip" id="character-tooltip">
            Click me âœ¨
          </span> -->
          <span class="character-hint">Click the picture âœ¨</span>

        </div>
      </div>
      <audio id="bg-music" loop>
        <source src="calling.mp3" type="audio/mpeg" />
        Your browser does not support the audio element.
      </audio>
    </div>
  </div>



  <script>
    // Smooth scroll when a project card is clicked
    document.querySelectorAll(".project-card").forEach((card) => {
      card.addEventListener("click", () => {
        const targetSelector = card.getAttribute("data-target");
        const target = document.querySelector(targetSelector);
        if (!target) return;
        target.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    });

    // "View my projects" button scrolls to projects row
    const projectsCta = document.getElementById("projects-cta");
    if (projectsCta) {
      projectsCta.addEventListener("click", () => {
        const projects = document.getElementById("projects");
        if (!projects) return;
        projects.scrollIntoView({ behavior: "smooth", block: "start" });
      });
    }

    // Theme toggle (dark / light)
    const root = document.documentElement;
    const themeToggle = document.getElementById("theme-toggle");

    if (themeToggle) {
      const storedTheme = localStorage.getItem("theme");
      if (storedTheme) {
        root.setAttribute("data-theme", storedTheme);
        themeToggle.textContent = storedTheme === "dark" ? "ðŸŒ™" : "â˜€ï¸";
      } else {
        root.setAttribute("data-theme", "dark");
        themeToggle.textContent = "ðŸŒ™";
      }

      themeToggle.addEventListener("click", () => {
        const current = root.getAttribute("data-theme");
        const next = current === "dark" ? "light" : "dark";
        root.setAttribute("data-theme", next);
        localStorage.setItem("theme", next);
        themeToggle.textContent = next === "dark" ? "ðŸŒ™" : "â˜€ï¸";
      });
    }

    // Background music toggle (small icon button)
    const music = document.getElementById("bg-music");
    const musicToggle = document.getElementById("music-toggle");
    let isPlaying = false;

    if (music && musicToggle) {
      musicToggle.textContent = "ðŸŽ§";

      musicToggle.addEventListener("click", async () => {
        try {
          if (!isPlaying) {
            await music.play();
            isPlaying = true;
            musicToggle.textContent = "â¸";
          } else {
            music.pause();
            isPlaying = false;
            musicToggle.textContent = "ðŸŽ§";
          }
        } catch (e) {
          console.error(e);
        }
      });
    }

    // Reveal About photo on scroll
    const aboutPhotoFrame = document.querySelector(".about-photo-frame");

    if (aboutPhotoFrame && "IntersectionObserver" in window) {
      const observer = new IntersectionObserver(
        (entries) => {
          entries.forEach((entry) => {
            if (entry.isIntersecting) {
              entry.target.classList.add("is-visible");
            } else {
              entry.target.classList.remove("is-visible");
            }
          });
        },
        { threshold: 0.25 }
      );

      observer.observe(aboutPhotoFrame);
    } else if (aboutPhotoFrame) {
      // Fallback: show immediately
      aboutPhotoFrame.classList.add("is-visible");
    }

    // Project character pose cycle
    const characterImg = document.getElementById("character-image");

    const characterPoses = [
      
      { src: "pictures/c1.png", alt: "Character working at laptop", type: "default" },
      { src: "pictures/c2.png", alt: "Character listening to music", type: "default" },
      { src: "pictures/c3.png", alt: "Character taking a photo", type: "default" },
      { src: "pictures/c4.png", alt: "Character tired with work", type: "default" },
      { src: "pictures/c5.png", alt: "Character working at laptop", type: "default" },
      { src: "pictures/c6.png", alt: "Character listening to music", type: "music" },
      { src: "pictures/c7.png", alt: "Character taking a photo", type: "default" },
      { src: "pictures/c8.png", alt: "Character tired with work", type: "default" }
      
    ];

    let characterIndex = 0;

    function updateCharacterPose() {
      const pose = characterPoses[characterIndex];
      characterImg.src = pose.src;
      characterImg.alt = pose.alt;

      if (pose.type === "music") {
        characterImg.title = "Play music at top of page ðŸŽ§";
      } else {
        characterImg.title = "Click me âœ¨";
      }
    }

    if (characterImg) {
      characterImg.addEventListener("click", () => {
        characterIndex = (characterIndex + 1) % characterPoses.length;
        updateCharacterPose();
      });

      updateCharacterPose();
    }

    // Hero typing effect
    const typingEl = document.getElementById("hero-typing");

    if (typingEl) {
      const phrases = [
        "Trying to find my place in this beautiful chaotic world O_o",
        "Building robots that actually do something useful.",
        "Designing playful embedded systems and side projects."
      ];

      let phraseIndex = 0;
      let charIndex = 0;
      let isDeleting = false;
      const typeSpeed = 70;      // ms per character while typing
      const deleteSpeed = 40;    // ms per character while deleting
      const holdDelay = 1200;    // pause when line is fully typed

      function typeLoop() {
        const current = phrases[phraseIndex];

        if (!isDeleting) {
          // typing forward
          typingEl.textContent = current.slice(0, charIndex + 1);
          charIndex++;

          if (charIndex === current.length) {
            isDeleting = true;
            setTimeout(typeLoop, holdDelay);
            return;
          }

          setTimeout(typeLoop, typeSpeed);
        } else {
          // deleting
          typingEl.textContent = current.slice(0, charIndex - 1);
          charIndex--;

          if (charIndex === 0) {
            isDeleting = false;
            phraseIndex = (phraseIndex + 1) % phrases.length;
            setTimeout(typeLoop, 300);
            return;
          }

          setTimeout(typeLoop, deleteSpeed);
        }
      }

      typeLoop();
    }

  </script>


  <script type="module">
    // Import Firebase modules from CDN
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      query,
      orderBy,
      onSnapshot,
      serverTimestamp,
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // 1) Your Firebase config 
    const firebaseConfig = {
      apiKey: "AIzaSyAhs6Ks1sooecjAVFsqNonb8rofpxAXdTg",
      authDomain: "guestbook-4e93b.firebaseapp.com",
      projectId: "guestbook-4e93b",
      storageBucket: "guestbook-4e93b.firebasestorage.app",
      messagingSenderId: "589189691850",
      appId: "1:589189691850:web:abe012d236e359afdf3733"
    };

    // 2) Init Firebase + Firestore
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // 3) Grab DOM elements
    const guestForm = document.getElementById("guestbook-form");
    const guestEntriesEl = document.getElementById("guestbook-entries");

    function renderGuestEntries(entries) {
      if (!guestEntriesEl) return;
      guestEntriesEl.innerHTML = "";
      entries.forEach((entry, index) => {
        const div = document.createElement("div");
        // sticky-note style
        div.className = "guest-entry note";

        const name = entry.name || "Anonymous";
        const role = entry.role || "";
        const message = entry.message || "";

        // tiny random rotation so board looks organic
        const tilt = (Math.random() - 0.5) * 4; // -2deg to +2deg
        div.style.transform = `rotate(${tilt}deg)`;

        div.innerHTML = `
          <div class="guest-entry-header">
            <span>${name}</span>
            <span class="guest-entry-role">${role}</span>
          </div>
          <div class="guest-entry-message">
            ${message}
          </div>
        `;
        guestEntriesEl.appendChild(div);
      });
    }

    // 4) Listen to Firestore in real time
    const guestbookRef = collection(db, "guestbook");
    const guestbookQuery = query(guestbookRef, orderBy("createdAt", "desc"));

    onSnapshot(guestbookQuery, (snapshot) => {
      const entries = snapshot.docs.map((doc) => doc.data());
      renderGuestEntries(entries);
    });

    // 5) Handle form submit â†’ add document
    if (guestForm) {
      guestForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const name = document.getElementById("guest-name").value.trim();
        const role = document.getElementById("guest-role").value.trim();
        const message = document.getElementById("guest-message").value.trim();
        if (!message) return;

        try {
          await addDoc(guestbookRef, {
            name,
            role,
            message,
            createdAt: serverTimestamp(),
          });
          guestForm.reset();
        } catch (err) {
          console.error("Error adding guest entry", err);
          alert("Could not save your message. Please try again.");
        }
      });
    }
  </script>


  <script>
    // ---- Skill graph data ----
    const skillData = {
      nodes: [
        { id: "me",       label: "ME",            group: "core",  size: 32, level: "Explorer of chaos" },
        { id: "frontend", label: "Frontend",      group: "area",  size: 22, level: "Intermediate" },
        { id: "backend",  label: "Backend",       group: "area",  size: 22, level: "Beginnerâ€“Intermediate" },
        { id: "embedded", label: "Embedded",      group: "area",  size: 26, level: "Strong" },
        { id: "robotics", label: "Robotics",      group: "area",  size: 26, level: "Strong" },
        { id: "js",       label: "JavaScript",    group: "skill", size: 18, level: "Intermediate" },
        { id: "python",   label: "Python",        group: "skill", size: 18, level: "Intermediate" },
        { id: "esp32",    label: "ESP32 / C",     group: "skill", size: 20, level: "Strong" },
        { id: "yolo",     label: "YOLO / CV",     group: "skill", size: 20, level: "Strong" },
        { id: "firebase", label: "Firebase",      group: "skill", size: 18, level: "Intermediate" }
      ],
      links: [
        { source: "me", target: "frontend" },
        { source: "me", target: "backend" },
        { source: "me", target: "embedded" },
        { source: "me", target: "robotics" },
        { source: "me", target: "python" },
        { source: "frontend", target: "js" },
        { source: "backend",  target: "js" },
        { source: "backend",  target: "firebase" },
        { source: "embedded", target: "esp32" },
        { source: "robotics", target: "esp32" },
        { source: "robotics", target: "yolo" },
        { source: "embedded", target: "yolo" },
        { source: "embedded", target: "python" },
        { source: "robotics", target: "python" }

      ],
      usage: {
        esp32: [
          "Flappy Bird game (ESP32 + OLED)",
          "Delivery mobile manipulator"
        ],
        yolo: [
          "Crop harvesting robot (ripeness detection with YOLO)"
        ],
        firebase: [
          "Portfolio guest book (Firestore realâ€‘time DB)",
          "Classroom-finder app (Firestore realâ€‘time DB)"
        ],
        js: [
          "Portfolio site interactions (JS + DOM)",
          "Web UI for delivery robot control"
        ],
        python: [
          "YOLO training + dataset scripts for agriâ€‘robot",
          "predicting crop yield using ML models"
        ],
        frontend: [
          "This portfolio UI and interactions",
          "Classroom-finder app UI"
        ],
        backend: [
          "Guest book API (Firebase / Firestore)",
          "Classroom allotment system backend"
        ],
        embedded: [
          "Flappy Bird on ESP32",
          "Lineâ€‘follower robot",
          "Delivery mobile manipulator"
        ],
        robotics: [
          "Lineâ€‘follower robot",
          "robotic-arm",
          "Delivery mobile manipulator",
          "Crop harvesting robot"
        ],
        me: [
          "Scroll through the page to see everything :)"
        ]
      }
    };

    window.addEventListener("load", () => {
      console.log("initSkillGraph starting");

      const svg = document.getElementById("skills-graph");
      if (!svg) {
        console.log("skills-graph SVG not found");
        return;
      }

      const bbox = svg.getBoundingClientRect();
      const width = bbox.width || 480;
      const height = svg.getAttribute("height") || 360;
      const ns = "http://www.w3.org/2000/svg";

      // details panel
      const titleEl = document.getElementById("skill-title");
      const levelEl = document.getElementById("skill-level");
      const projectsEl = document.getElementById("skill-projects");

      let activeNodeId = null;
      let nodeEls = []; // filled later

      function showSkillDetails(node) {
        if (!titleEl || !levelEl || !projectsEl) return;

        activeNodeId = node.id;

        titleEl.textContent = node.label;
        levelEl.textContent = `Skill level: ${node.level || "â€“"}`;

        projectsEl.innerHTML = "";
        const use = skillData.usage[node.id] || [];
        if (!use.length) {
          const li = document.createElement("li");
          li.textContent = "No specific projects listed yet.";
          projectsEl.appendChild(li);
        } else {
          use.forEach(p => {
            const li = document.createElement("li");
            li.textContent = p;
            projectsEl.appendChild(li);
          });
        }

        // highlight selected bubble
        nodeEls.forEach((g, i) => {
          const n = skillData.nodes[i];
          if (n.id === activeNodeId) {
            g.classList.add("skill-node-active");
          } else {
            g.classList.remove("skill-node-active");
          }
        });
      }

      // initial positions in a simple ring around center
      const centerX = width / 2;
      const centerY = height / 2;
      const radius = 130;

      skillData.nodes.forEach((n, i) => {
        if (n.id === "me") {
          n.x = centerX;
          n.y = centerY;
        } else {
          const angle = (i / skillData.nodes.length) * 2 * Math.PI;
          n.x = centerX + radius * Math.cos(angle);
          n.y = centerY + radius * Math.sin(angle);
        }
      });

      const links = skillData.links.map(l => ({
        ...l,
        source: skillData.nodes.find(n => n.id === l.source),
        target: skillData.nodes.find(n => n.id === l.target)
      }));

      // links
      const linkEls = links.map(() => {
        const line = document.createElementNS(ns, "line");
        line.setAttribute("stroke", "rgba(148,163,184,0.6)");
        line.setAttribute("stroke-width", "1.3");
        svg.appendChild(line);
        return line;
      });

      // nodes â€“ clickable + draggable (with click/drag separation)
      nodeEls = skillData.nodes.map(n => {
        const g = document.createElementNS(ns, "g");
        const circle = document.createElementNS(ns, "circle");
        const label = document.createElementNS(ns, "text");

        const baseColor =
          n.id === "me"
            ? "#f97316"
            : n.group === "area"
            ? "#3b82f6"
            : "#22c55e";

        circle.setAttribute(
          "r",
          n.id === "me" ? 30 : n.group === "area" ? 22 : 16
        );
        circle.setAttribute("fill", baseColor);
        circle.setAttribute("stroke", "rgba(15,23,42,0.9)");
        circle.setAttribute("stroke-width", "1.5");

        label.textContent = n.label;
        label.setAttribute("class", "skill-node-label");
        label.setAttribute("text-anchor", "middle");
        label.setAttribute("dy", n.id === "me" ? 38 : 26);

        g.appendChild(circle);
        g.appendChild(label);
        svg.appendChild(g);

        g.setAttribute("transform", `translate(${n.x},${n.y})`);
        g.style.cursor = "pointer";

        // drag + click detection
        let dragging = false;
        let offsetX = 0;
        let offsetY = 0;
        let startX = 0;
        let startY = 0;

        g.addEventListener("pointerdown", e => {
          dragging = true;
          svg.setPointerCapture(e.pointerId);
          startX = e.clientX;
          startY = e.clientY;
          offsetX = n.x - e.offsetX;
          offsetY = n.y - e.offsetY;
        });

        svg.addEventListener("pointermove", e => {
          if (!dragging) return;
          const moveDist = Math.hypot(e.clientX - startX, e.clientY - startY);
          if (moveDist > 3) {
            n.x = e.offsetX + offsetX;
            n.y = e.offsetY + offsetY;
            updatePositions();
          }
        });

        svg.addEventListener("pointerup", e => {
          if (!dragging) return;
          const upDist = Math.hypot(e.clientX - startX, e.clientY - startY);
          dragging = false;
          // treat as click if very little movement
          if (upDist <= 3) {
            showSkillDetails(n);
          }
        });

        svg.addEventListener("pointerleave", () => {
          dragging = false;
        });

        return g;
      });

      // one function to update positions of nodes + links
      function updatePositions() {
        links.forEach((l, i) => {
          const line = linkEls[i];
          line.setAttribute("x1", l.source.x);
          line.setAttribute("y1", l.source.y);
          line.setAttribute("x2", l.target.x);
          line.setAttribute("y2", l.target.y);
        });

        nodeEls.forEach((g, i) => {
          const n = skillData.nodes[i];
          g.setAttribute("transform", `translate(${n.x},${n.y})`);
        });
      }

      // draw once initially
      updatePositions();

      // pre-select ME
      const meNode = skillData.nodes.find(n => n.id === "me");
      if (meNode) showSkillDetails(meNode);
    });

  </script>

</body>
</html>
